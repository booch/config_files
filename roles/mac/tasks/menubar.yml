---

- name: Disable transparency in the menu bar
  osx_defaults:
    domain: NSGlobalDomain
    key: AppleEnableMenuBarTransparency
    value: FALSE
    type: bool
  notify:
    - Restart SystemUIServer

- name: Show battery percentage charged
  osx_defaults:
    domain: com.apple.menuextra.battery
    key: ShowPercent
    value: "YES"
  notify:
    - Restart SystemUIServer

# System Preferences > Date & Time > Clock
# Time options: Digital
- name: Set date display to digital
  osx_defaults:
    domain: com.apple.menuextra.clock
    key: IsAnalog
    value: FALSE
    type: bool
  notify:
    - Restart SystemUIServer

# System Preferences > Date & Time > Clock
# Time options: Display the time with seconds: off
# Date options: Show the day of the week: on
# Date options: Show date: off
- name: Set date display format
  osx_defaults:
    domain: com.apple.menuextra.clock
    key: DateFormat
    value: "EEE h:mm"
  notify:
    - Restart SystemUIServer

- name: Determine whether Notification Center UI is running
  shell: launchctl list | grep 'com\.apple\.notificationcenterui\.agent'
  register: notification_center_ui
  ignore_errors: TRUE
  changed_when: FALSE

- name: Disable Notification Center UI
  command: launchctl unload -w /System/Library/LaunchAgents/com.apple.notificationcenterui.plist
  notify:
    - Restart SystemUIServer
  when: notification_center_ui.rc == 0

# This adds the icon to the menu bar to select your language and keyboard layout
# System Preferences > Keyboard > Input Sources > Show Input menu in menu bar
# TODO: Need to test this.
# - name: Show Input selector icon in menu bar
#   osx_defaults:
#     domain: com.apple.systemuiserver
#     key: menuExtras
#     value: "/System/Library/CoreServices/Menu Extras/TextInput.menu"
#     type: string
#     array_add: TRUE

# This adds the icon to the menu bar to select input from the on-screen keyboard or the symbol/emoji pallette
# System Preferences > Keyboard > Keyboard > Show Keyboard, Emoji, & Symbol Viewers in menu bar
# TODO: Need to wait for `dict_add` (or add it myself).
# - name: Show Symbol and Emoji viewers in Input selector icon in menu bar
#   osx_defaults:
#     domain: com.apple.HIToolbox
#     key: AppleEnabledInputSources
#     value: "{{ item }}"
#     type: dict
#     dict_add: TRUE
#   with_items:
#     - { "Bundle ID": "com.apple.CharacterPaletteIM", InputSourceKind: "Non Keyboard Input Method" }
#     - { "Bundle ID": "com.apple.KeyboardViewer", InputSourceKind: "Non Keyboard Input Method" }

- name: Have Collective start on boot
  osx_defaults:
    domain: com.generation-loss.collective
    key: launchAtLogin
    value: 1
    type: integer

- name: Trick Collective into thinking this is not the first time it's been run
  osx_defaults:
    domain: com.generation-loss.collective
    key: firstRun
    value: 0
    type: integer

- name: Start Collective
  command: open /Applications/Collective.app
